import{K as e,Y as t,Z as l,$ as o,d as n,O as a,a0 as i,a1 as s,r as c,a2 as u,a3 as r,a4 as v,N as m,a5 as d,a6 as p,h as f,S as h,a7 as g,a8 as b,Q as y,a9 as x,M as O,aa as w,w as k,ab as H,L as T,ac as N,ad as V,ae as S,af as C,T as I}from"../default/default-230bf5e4.js";const[B,M,D]=e("picker"),$=e=>e.find(e=>!e.disabled)||e[0];function j(e,t){for(let l=t=o(t,0,e.length);l<e.length;l++)if(!e[l].disabled)return l;for(let l=t-1;l>=0;l--)if(!e[l].disabled)return l;return 0}const P=(e,t,l)=>void 0!==t&&e.some(e=>e[l.value]===t);function E(e,t,l){const o=e.findIndex(e=>e[l.value]===t);return e[j(e,o)]}const[A,L]=e("picker-column"),_=Symbol(A);var F=n({name:A,props:{value:a,fields:i(Object),options:s(),readonly:Boolean,allowHtml:Boolean,optionHeight:i(Number),swipeDuration:i(a),visibleOptionNum:i(a)},emits:["change","clickOption","scrollInto"],setup(e,{emit:t,slots:l}){let n,a,i,s,g;const b=c(),y=c(),x=c(0),O=c(0),w=u(),k=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,T=l=>{let o=j(e.options,l);const a=-o*e.optionHeight,i=()=>{o>k()-1&&(o=j(e.options,l));const n=e.options[o][e.fields.value];n!==e.value&&t("change",n)};n&&a!==x.value?g=i:i(),x.value=a},N=()=>e.readonly||!e.options.length,V=t=>o(Math.round(-t/e.optionHeight),0,k()-1),S=r(()=>V(x.value)),C=()=>{n=!1,O.value=0,g&&(g(),g=null)},I=e=>{if(!N()){if(w.start(e),n){const e=function(e){const{transform:t}=window.getComputedStyle(e),l=t.slice(7,t.length-1).split(", ")[5];return Number(l)}(y.value);x.value=Math.min(0,e-H())}O.value=0,a=x.value,i=Date.now(),s=a,g=null}},B=()=>{if(N())return;const t=x.value-s,l=Date.now()-i;if(l<300&&Math.abs(t)>15)return void((t,l)=>{const o=Math.abs(t/l);t=x.value+o/.003*(t<0?-1:1);const n=V(t);O.value=+e.swipeDuration,T(n)})(t,l);const o=V(x.value);O.value=200,T(o),setTimeout(()=>{n=!1},0)},M=()=>{const o={height:`${e.optionHeight}px`};return e.options.map((a,i)=>{const s=a[e.fields.text],{disabled:c}=a,u=a[e.fields.value],r={role:"button",style:o,tabindex:c?-1:0,class:[L("item",{disabled:c,selected:u===e.value}),a.className],onClick:()=>(l=>{n||N()||(g=null,O.value=200,T(l),t("clickOption",e.options[l]))})(i)},v={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:s};return f("li",r,[l.option?l.option(a,i):f("div",v,null)])})};return v(_),m({stopMomentum:C}),d(()=>{const t=n?Math.floor(-x.value/e.optionHeight):e.options.findIndex(t=>t[e.fields.value]===e.value),l=j(e.options,t),o=-l*e.optionHeight;n&&l<t&&C(),x.value=o}),p("touchmove",l=>{if(N())return;w.move(l),w.isVertical()&&(n=!0,h(l,!0));const c=o(a+w.deltaY.value,-k()*e.optionHeight,e.optionHeight),u=V(c);u!==S.value&&t("scrollInto",e.options[u]),x.value=c;const r=Date.now();r-i>300&&(i=r,s=c)},{target:b}),()=>f("div",{ref:b,class:L(),onTouchstartPassive:I,onTouchend:B,onTouchcancel:B},[f("ul",{ref:y,style:{transform:`translate3d(0, ${x.value+H()}px, 0)`,transitionDuration:`${O.value}ms`,transitionProperty:O.value?"all":"none"},class:L("wrapper"),onTransitionend:C},[M()])])}});const[Y]=e("picker-toolbar"),z={title:String,cancelButtonText:String,confirmButtonText:String},K=["cancel","confirm","title","toolbar"],Q=Object.keys(z);var U=n({name:Y,props:z,emits:["confirm","cancel"],setup(e,{emit:t,slots:l}){const o=()=>t("cancel"),n=()=>t("confirm"),a=()=>{var t;const n=null!=(t=e.cancelButtonText)?t:D("cancel");if(l.cancel||n)return f("button",{type:"button",class:[M("cancel"),g],onClick:o},[l.cancel?l.cancel():n])},i=()=>{var t;const o=null!=(t=e.confirmButtonText)?t:D("confirm");if(l.confirm||o)return f("button",{type:"button",class:[M("confirm"),g],onClick:n},[l.confirm?l.confirm():o])};return()=>f("div",{class:M("toolbar")},[l.toolbar?l.toolbar():[a(),l.title?l.title():e.title?f("div",{class:[M("title"),"van-ellipsis"]},[e.title]):void 0,i()]])}});const[Z,q]=e("picker-group"),G=Symbol(Z);l({tabs:s(),activeTab:b(0),nextStepText:String,showToolbar:y},z);const J=l({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:b(44),showToolbar:y,swipeDuration:b(1e3),visibleOptionNum:b(6)},z);var R=n({name:B,props:l({},J,{columns:s(),modelValue:s(),toolbarPosition:x("top"),columnsFieldNames:Object}),emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const a=c(),i=c(e.modelValue.slice(0)),{parent:s}=v(G),{children:u,linkChildren:d}=O(_);d();const g=r(()=>function(e){return l({text:"text",value:"value",children:"children"},e)}(e.columnsFieldNames)),b=r(()=>w(e.optionHeight)),y=r(()=>function(e,t){const l=e[0];if(l){if(Array.isArray(l))return"multiple";if(t.children in l)return"cascade"}return"default"}(e.columns,g.value)),x=r(()=>{const{columns:l}=e;switch(y.value){case"multiple":return l;case"cascade":return function(e,l,o){const n=[];let a={[l.children]:e},i=0;for(;a&&a[l.children];){const e=a[l.children],s=o.value[i];a=t(s)?E(e,s,l):void 0,!a&&e.length&&(a=E(e,$(e)[l.value],l)),i++,n.push(e)}return n}(l,g.value,i);default:return[l]}}),I=r(()=>x.value.some(e=>e.length)),B=r(()=>x.value.map((e,t)=>E(e,i.value[t],g.value))),D=r(()=>x.value.map((e,t)=>e.findIndex(e=>e[g.value.value]===i.value[t]))),j=(e,t)=>{if(i.value[e]!==t){const l=i.value.slice(0);l[e]=t,i.value=l}},A=()=>({selectedValues:i.value.slice(0),selectedOptions:B.value,selectedIndexes:D.value}),L=()=>{u.forEach(e=>e.stopMomentum());const e=A();return N(()=>{const e=A();o("confirm",e)}),e},Y=()=>o("cancel",A()),z=()=>x.value.map((t,a)=>f(F,{value:i.value[a],fields:g.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:e=>((e,t)=>{j(t,e),"cascade"===y.value&&i.value.forEach((e,t)=>{const l=x.value[t];P(l,e,g.value)||j(t,l.length?l[0][g.value.value]:void 0)}),N(()=>{o("change",l({columnIndex:t},A()))})})(e,a),onClickOption:e=>((e,t)=>{const n={columnIndex:t,currentOption:e};o("clickOption",l(A(),n)),o("scrollInto",n)})(e,a),onScrollInto:e=>{o("scrollInto",{currentOption:e,columnIndex:a})}},{option:n.option})),Z=e=>{if(I.value){const t={height:`${b.value}px`},l={backgroundSize:`100% ${(e-b.value)/2}px`};return[f("div",{class:M("mask"),style:l},null),f("div",{class:[C,M("frame")],style:t},null)]}},q=()=>{const t=b.value*+e.visibleOptionNum,l={height:`${t}px`};return e.loading||I.value||!n.empty?f("div",{ref:a,class:M("columns"),style:l},[z(),Z(t)]):n.empty()},J=()=>{if(e.showToolbar&&!s)return f(U,S(V(e,Q),{onConfirm:L,onCancel:Y}),V(n,K))},R=e=>{e.forEach((e,t)=>{e.length&&!P(e,i.value[t],g.value)&&j(t,$(e)[g.value.value])})};let W;k(x,e=>R(e),{immediate:!0}),k(()=>e.modelValue,t=>{H(t,i.value)||H(t,W)||(i.value=t.slice(0),W=t.slice(0)),0===e.modelValue.length&&R(x.value)},{deep:!0}),k(i,t=>{H(t,e.modelValue)||(W=t.slice(0),o("update:modelValue",W))},{immediate:!0}),p("touchmove",h,{target:a});return m({confirm:L,getSelectedOptions:()=>B.value}),()=>{var t,l;return f("div",{class:M()},["top"===e.toolbarPosition?J():null,e.loading?f(T,{class:M("loading")},null):null,null==(t=n["columns-top"])?void 0:t.call(n),q(),null==(l=n["columns-bottom"])?void 0:l.call(n),"bottom"===e.toolbarPosition?J():null])}}});const W="000000",X=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],ee=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],te=(e="",t=W,l=void 0)=>({text:e,value:t,children:l});function le({areaList:e,columnsNum:t,columnsPlaceholder:l}){const{city_list:o={},county_list:n={},province_list:a={}}=e,i=+t>1,s=+t>2,c=new Map;Object.keys(a).forEach(e=>{c.set(e.slice(0,2),te(a[e],e,(()=>{if(i)return l.length>1?[te(l[1],W,s?[]:void 0)]:[]})()))});const u=new Map;if(i){const e=()=>{if(s)return l.length>2?[te(l[2])]:[]};Object.keys(o).forEach(t=>{const l=te(o[t],t,e());u.set(t.slice(0,4),l);const n=c.get(t.slice(0,2));n&&n.children.push(l)})}s&&Object.keys(n).forEach(e=>{const t=u.get(e.slice(0,4));t&&t.children.push(te(n[e],e))});const r=Array.from(c.values());if(l.length){const e=s?[te(l[2])]:void 0,t=i?[te(l[1],W,e)]:void 0;r.unshift(te(l[0],W,t))}return r}const oe=I(R),[ne,ae]=e("area");const ie=I(n({name:ne,props:l({},V(J,ee),{modelValue:String,columnsNum:b(3),columnsPlaceholder:s(),areaList:{type:Object,default:()=>({})}}),emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:t,slots:l}){const o=c([]),n=c(),a=r(()=>le(e)),i=(...e)=>t("change",...e),s=(...e)=>t("cancel",...e),u=(...e)=>t("confirm",...e);return k(o,l=>{const o=l.length?l[l.length-1]:"";o&&o!==e.modelValue&&t("update:modelValue",o)},{deep:!0}),k(()=>e.modelValue,t=>{if(t){t!==(o.value.length?o.value[o.value.length-1]:"")&&(o.value=[`${t.slice(0,2)}0000`,`${t.slice(0,4)}00`,t].slice(0,+e.columnsNum))}else o.value=[]},{immediate:!0}),m({confirm:()=>{var e;return null==(e=n.value)?void 0:e.confirm()},getSelectedOptions:()=>{var e;return(null==(e=n.value)?void 0:e.getSelectedOptions())||[]}}),()=>f(oe,S({ref:n,modelValue:o.value,"onUpdate:modelValue":e=>o.value=e,class:ae(),columns:a.value,onChange:i,onCancel:s,onConfirm:u},V(e,ee)),V(l,X))}}));export{ie as A};
